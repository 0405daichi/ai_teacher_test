<%# app/views/questions/index.html.erb %>

<div class="container mt-5 d-flex flex-column align-items-center justify-content-center" style="height: 100vh;">
  <h1></h1>

  <% if user_signed_in? %>
    <div id="current-user-id" data-user-id="<%= current_user.id %>" style="display:none;"></div>
    <button id="user-button" data-user-id="<%= current_user.id %>" class="btn btn-secondary m-3 user-button position-fixed top-0 end-0">
      マイページ
    </button>

    <button id="liked-questions-button" data-user-id="<%= current_user.id %>" class="btn btn-secondary m-3 liked-questions-button position-fixed" style="top: 44px; right: 0;">
      いいね
    </button>

    <button id="saved-questions-button" data-user-id="<%= current_user.id %>" class="btn btn-secondary m-3 saved-questions-button position-fixed" style="top: 88px; right: 0;">
      保存
    </button>

    <div class="user-page">
      <!-- マイページの内容 -->
      <%= render template: "users/show" %>
    </div>

    <div class="liked-questions-page">
      <!-- いいねしたカード一覧 -->
      <%= render template: "likes/show" %>
    </div>

    <div class="saved-questions-page">
      <!-- 保存したカード一覧 -->
      <%= render template: "saved_questions/show" %>
    </div>
  <% end %>

  <!-- 企業ロゴ -->
  <img id="home-image" src="<%= image_path('yahoo-rogo-removebg-preview.png') %>" alt="Main image" style="cursor: pointer;">

  <!-- クリックするとモーダルが表示される画像 -->
  <img id="second-home-image" src="<%= image_path('eigo.png') %>" alt="Second image" style="cursor: pointer;">

  <!-- 新たに追加するモーダル -->
  <div class="modal fade" id="input-options-modal" tabindex="-1" aria-labelledby="choice-modal-label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="choice-modal-label">何をしますか？</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <button id="open-question-modal-button" class="btn btn-primary" data-bs-dismiss="modal">問題を解かせる・質問する</button>
          <button id="open-search-modal-button" class="btn btn-secondary" data-bs-dismiss="modal">他の人がした質問から似た質問を探す</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 検索フォーム -->
<div class="mb-3 p-3" id="search-form-container" style="display: none;">
  <button id="open-image-modal" type="button" class="btn open-image-modal-btn btn-primary mt-2">画像で入力する</button>
  <%= form_with url: search_questions_path, method: :get, local: true, id: 'search-form' do |form| %>
    <%= form.label :query, '質問を検索する' %>
    <%= form.text_area :query, id: 'search-query', name: 'query', class: 'form-control', placeholder: '質問を入力してください' %>
    <%= form.submit '検索する', class: 'btn btn-primary mt-2' %>
  <% end %>
</div>

<!-- 検索結果表示エリア -->
<div id="search-results" class="row"></div>

<!-- 質問フォーム -->
<div class="mb-3 p-3" id="question-form-container" style="display: none;">
  <button id="open-image-modal" type="button" class="btn open-image-modal-btn btn-primary mt-2">画像で入力する</button>
  <%= form_with url: get_answer_questions_path, method: :post, local: false, id: 'question-form', html: { onsubmit: 'return false;' } do |form| %>
    <%= form.label :content, '教科' %>
    <%= form.select :subject, ['その他', '国語', '数学', '社会', '理科', '英語'], {}, class: 'form-select' %>
    <%= form.label :content, '宿題内容' %>
    <%= form.text_area :content, id: 'question-input', name: 'question[content]', class: 'form-control', placeholder: '宿題の内容を入力してください' %>
    <%= form.submit '質問する', class: 'btn btn-primary mt-2' %>
  <% end %>
</div>

<div id="loading-spinner" class="d-none text-center">
  <div class="spinner-border" role="status"></div>
  <p>宿題中です。しばらくお待ちください。</p>
</div>

<div id="questions-list" class="row"></div>

<!-- Image Upload Modal -->
<div class="modal fade" id="image-upload-modal" tabindex="-1" aria-labelledby="image-upload-modal-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="image-upload-modal-label">画像の選択</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body image-upload-modal-body">
        <button id="select-from-library-button" class="btn btn-primary">ライブラリから選択</button>
        <button id="capture-from-camera-button" class="btn btn-secondary">カメラで撮影</button>

        <!-- Hidden file input -->
        <input type="file" id="image-file-input" accept="image/*" style="display: none;">
        <input type="file" id="camera-input" accept="image/*" capture="camera" style="display: none;">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
      </div>
    </div>
  </div>
</div>
